plugins {
    id "fi.jasoft.plugin.vaadin" version '0.11.4'
}

vaadin {
    version '7.7.4'
    addon.title = "constellio"

    widgetset 'com.constellio.app.ui.application.widgetset.AppWidgetset'
    manageWidgetset true

    debug true
    debugPort 8000
    profiler true

    manageRepositories = true
    manageDependencies true

    serverPort 8080

    jvmArgs()

    //mainSourceSet sourceSets.main.allJava

    vaadin.plugin.themesDirectory 'VAADIN/themes/constellio'
    vaadin.plugin.themeAutoRecompile true
}

dependencies {
    testCompile project(":data")
    testCompile project(":model")
    testCompile project(":app")

    testCompile "com.h2database:h2:1.4.182"
    testCompile "com.carrotsearch:junit-benchmarks:0.7.2"
    testCompile "org.glassfish.jersey.core:jersey-client:2.13"
    testCompile "org.apache.chemistry.opencmis:chemistry-opencmis-client-bindings:0.12.0"
    testCompile "org.apache.chemistry.opencmis:chemistry-opencmis-client-impl:0.12.0"
    testCompile "org.databene:contiperf:2.2.0"
    testCompile "commons-httpclient:commons-httpclient:3.1"
    testCompile "org.seleniumhq.selenium.fluent:fluent-selenium:1.14.5"
    testCompile "org.eclipse.jetty.aggregate:jetty-all-server:8.1.10.v20130312"
    testCompile "org.slf4j:slf4j-log4j12:1.7.7"
    testCompile "org.slf4j:slf4j-api:1.7.7"
    testCompile "javax.servlet:javax.servlet-api:3.1.0"
    testCompile "com.vaadin:vaadin-shared:7.7.4"
    testCompile "com.vaadin:vaadin-client:7.7.4"
    testCompile "com.vaadin:vaadin-server:7.7.4"
    testCompile "com.vaadin:vaadin-themes:7.7.4"
    testCompile "com.vaadin:vaadin-client-compiled:7.7.4"
//    testCompile "com.vaadin:vaadin-client-compiler:7.7.4"
    testCompile "com.vaadin:vaadin-sass-compiler:0.9.11"
    testCompile "javax.servlet:javax.servlet-api:3.1.0"
    testCompile "javax.servlet.jsp:jsp-api:2.2"
    testCompile "junit:junit:4.11"
    testCompile "org.mockito:mockito-all:1.10.8"
    testCompile "commons-logging:commons-logging:1.1.3"
    testCompile "org.apache.tika:tika-core:1.5"
    testCompile "org.assertj:assertj-core:1.6.0"
    testCompile "com.github.detro.ghostdriver:phantomjsdriver:1.1.0"
    testCompile "org.apache.zookeeper:zookeeper:3.4.6"
    testCompile "javax.validation:validation-api:1.0.0.GA"
    testCompile "com.squareup:javapoet:1.7.0";

    compile project(":data")
    compile project(":model")
    compile project(":app")

    compile "com.cybozu.labs:langdetect:1.1-20120112"
    compile "org.apache.chemistry.opencmis:chemistry-opencmis-client-bindings:0.12.0"
    compile "org.apache.chemistry.opencmis:chemistry-opencmis-client-impl:0.12.0"
    compile "junit:junit:4.11"
    compile "org.mockito:mockito-all:1.10.8"
    compile "org.assertj:assertj-core:1.6.0"
    compile "com.github.detro.ghostdriver:phantomjsdriver:1.1.0"
    compile "javax.servlet:javax.servlet-api:3.1.0"
    compile "javax.servlet.jsp:jsp-api:2.2"
    compile "com.vaadin:vaadin-shared:7.7.4"
    compile "com.vaadin:vaadin-client:7.7.4"
    compile "com.vaadin:vaadin-server:7.7.4"
    compile "com.vaadin:vaadin-themes:7.7.4"
    compile "com.vaadin:vaadin-client-compiled:7.7.4"
//    compile "com.vaadin:vaadin-client-compiler:7.7.4"
    compile "com.vaadin:vaadin-sass-compiler:0.9.11"
    compile "org.apache.solr:solr-solrj:6.4.2"
    compile "org.apache.solr:solr-core:6.4.2"
    compile "org.apache.zookeeper:zookeeper:3.4.6"
    compile "javax.validation:validation-api:1.1.0.Final"

}
configurations {
    compile.exclude group: "org.ow2.asm:asm:asm-debug-all-5.0.1"
}

eclipse {
    project {
        name = 'sdk'
        buildCommand 'compileJava'
    }
}


sourceSets {
    test {
        java {
            srcDir "src/"
        }
        resources {
            srcDir "sdk-resources"
        }
    }
}

task jarTest(type: Jar, dependsOn: testClasses) {
    from sourceSets.test.output
    classifier = 'test'
}

task jarDependencies(type: Jar, dependsOn: testClasses) {
    dependsOn configurations.runtime
    zip64 true
    classifier = 'dependencies'
    doFirst {
        from(configurations.runtime.resolve().collect { it.isDirectory() ? it : zipTree(it) }) {
            exclude 'META-INF/*.SF'
            exclude 'META-INF/*.DSA'
            exclude 'META-INF/*.RSA'
        }
    }
}

configurations {
    testArtifacts
    testDependencies
}

artifacts {
    testArtifacts jarTest
    testDependencies jarDependencies
}

sonarqube {
    properties {
        property "sonar.jacoco.reportPath", "$projectDir/sdk/build/jacoco/test.exec"
        property "sonar.junit.reportsPath", "$projectDir/sdk/build/reports/"
        property "sonar.projectName", "constellio"
        property "sonar.projectKey", "constellio"
        property "sonar.sources", "src/"
    }
}